# API-шлюз (Gateway)

## Обзор
API-шлюз - это входная точка для всех клиентских запросов к микросервисам. Он отвечает за маршрутизацию запросов к соответствующим микросервисам, аутентификацию, авторизацию и другие сквозные задачи.

## Функциональность
- Маршрутизация запросов к микросервисам
- Проверка JWT-токенов для аутентификации
- Проверка ролей для авторизации
- Балансировка нагрузки
- Единая точка входа для внешних клиентов

## Технологический стек
- Java 21
- Spring Boot 3.x
- Spring Cloud Gateway
- Spring Cloud (Eureka Client)
- Netty (асинхронный неблокирующий сервер)

## Конфигурация
Шлюз использует следующую конфигурацию:
- Обнаружение сервисов: Eureka
- Маршрутизация: Spring Cloud Gateway
- Безопасность: Custom JWT фильтры

## Маршруты
Шлюз определяет следующие основные группы маршрутов:
- `/api/auth/**` - маршруты аутентификации
- `/api/users/**` - маршруты для управления пользователями
- `/api/barbershops/**` - маршруты для управления барбершопами
- `/api/records/**` - маршруты для управления записями

## Безопасность
Шлюз реализует следующие механизмы безопасности:
- Проверка JWT-токенов
- Проверка ролей доступа
- Настройка CORS для веб-клиента

## Зависимости
- Eureka Server: Регистрация и обнаружение сервисов
- User Service: Проверка аутентификации и авторизации

## Разработка
Для локального запуска сервиса:

1. Убедитесь, что Eureka Server работает
2. Установите необходимые переменные окружения (см. файл `.env`)
3. Запустите приложение: `./gradlew bootRun`

## Docker
Сервис можно развернуть с помощью Docker. Для этого следует скачать образ из Docker Hub и запустить его с помощью команды:
```bash
docker run -p 9090:9090 krupnoveo/barbershop_with_microservices_gateway
```

## Переменные окружения
- `gateway.port`: Порт, на котором работает шлюз
- `eureka.service.host`: Хост Eureka сервера
- `eureka.service.port`: Порт Eureka сервера
- `user.service.name`: Имя сервиса пользователей для маршрутизации
- `barbershop.service.name`: Имя сервиса барбершопов для маршрутизации
- `record.service.name`: Имя сервиса записей для маршрутизации

## Важно
API-шлюз должен быть запущен после Eureka Server, но перед другими микросервисами, чтобы они могли зарегистрироваться через него. 